{"version":3,"sources":["app.js"],"names":["angular","module","config","RestangularProvider","setDefaultHeaders","setFullRequestInterceptor","element","operation","route","url","headers","params","httpConfig","token","sessionStorage","getItem","_","extend","Authorization","BaseCtrl","$rootScope","$state","getServer","buildURL","path","signedIn","signout","clear","window","location","reload","controller","DashboardCtrl","$scope","Restangular","$stateParams","user","JSON","parse","sync","oneUrl","post","then","response","setItems","retrieved_items","syncToken","sync_token","catch","console","log","selectAll","subItems","item","checked","deselect","items","pageSize","currentItemsIndex","paginate","slice","paginatePrev","paginateNext","length","deleteSelectedWithSync","selected","filter","confirm","deleted","request","showDelete","savedItems","saved_items","savedItem","localItem","find","uuid","merge","destroySelected","destroyItems","destroyAll","uuids","map","remove","difference","HomeCtrl","formData","server","email","id","password","pw","submitLogin","setItem","stringify","error","data","$stateProvider","$urlRouterProvider","$locationProvider","state","abstract","parent","views","templateUrl","otherwise","$injector","$location","get","go","html5Mode"],"mappings":"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","file":"transpiled.js","sourcesContent":["'use strict';\n\nangular.module('app', [\n  'ui.router',\n  'restangular'\n])\n\n.config(function (RestangularProvider) {\n  RestangularProvider.setDefaultHeaders({\"Content-Type\": \"application/json\"});\n  RestangularProvider.setFullRequestInterceptor(function(element, operation, route, url, headers, params, httpConfig) {\n    var token = sessionStorage.getItem(\"jwt\");\n    if(token) {\n      headers = _.extend(headers, {Authorization: \"Bearer \" + token});\n    }\n\n    return {\n      element: element,\n      params: params,\n      headers: headers,\n      httpConfig: httpConfig\n    };\n  });\n})\n;class BaseCtrl {\n  constructor($rootScope, $state) {\n\n    $rootScope.getServer = function() {\n      return sessionStorage.getItem(\"server\");\n    }\n\n    $rootScope.buildURL = function(path) {\n      return $rootScope.getServer() + \"/\" + path;\n    }\n\n    $rootScope.signedIn = sessionStorage.getItem(\"jwt\");\n\n    $rootScope.signout = function() {\n      sessionStorage.clear();\n      $rootScope.signedIn = false;\n      window.location.reload();\n    }\n  }\n}\n\nangular.module('app').controller('BaseCtrl', BaseCtrl);\n;class DashboardCtrl {\n  constructor($rootScope, $scope, Restangular, $stateParams) {\n    $scope.user = JSON.parse(sessionStorage.getItem(\"user\"));\n\n    $scope.sync = function() {\n      var url = $rootScope.buildURL(\"items/sync\");\n      Restangular.oneUrl(url, url).post().then(function(response){\n        $scope.setItems(response.retrieved_items);\n        $scope.syncToken = response.sync_token;\n      })\n      .catch(function(response){\n        console.log(\"Error: \", response);\n      })\n    }\n\n    $scope.sync();\n\n    $scope.selectAll = function() {\n      for(var item of $scope.subItems) {\n        item.checked = !item.checked;\n      }\n    }\n\n    $scope.deselect = function(items) {\n      for(var item of items) {\n        item.checked = false;\n      }\n    }\n\n    $scope.pageSize = 200;\n\n    $scope.setItems = function(items) {\n      $scope.items = items;\n      $scope.currentItemsIndex = 0;\n      $scope.paginate();\n    }\n\n    $scope.paginate = function() {\n      $scope.subItems = $scope.items.slice($scope.currentItemsIndex, $scope.currentItemsIndex + $scope.pageSize);\n    }\n\n    $scope.paginatePrev = function() {\n      $scope.currentItemsIndex -= $scope.pageSize;\n      if($scope.currentItemsIndex < 0) {\n        $scope.currentItemsIndex = 0;\n      }\n      $scope.paginate();\n    }\n\n    $scope.paginateNext = function() {\n      if($scope.currentItemsIndex + $scope.pageSize >= $scope.items.length) {\n        $scope.currentItemsIndex = $scope.items.length - $scope.pageSize;\n      } else {\n        $scope.currentItemsIndex += $scope.pageSize;\n      }\n      $scope.paginate();\n    }\n\n    $scope.deleteSelectedWithSync = function() {\n      let selected = $scope.subItems.filter(function(item){return item.checked});\n\n      if(!confirm(`Are you sure you want to delete and sync ${selected.length} items?`)) {\n        return;\n      }\n\n      for(var item of selected) {\n        item.deleted = true;\n      }\n\n      var url = $rootScope.buildURL(\"items/sync\");\n      var request = Restangular.oneUrl(url, url);\n      request.items = selected;\n      request.sync_token = $scope.syncToken;\n      console.log(\"request items\", request.items);\n      request.post().then(function(response){\n        $scope.deselect(selected);\n        $scope.showDelete = false;\n        var savedItems = response.saved_items;\n        for(var savedItem of savedItems) {\n          var localItem = _.find($scope.items, {uuid: savedItem.uuid});\n          _.merge(localItem, savedItem);\n        }\n      })\n      .catch(function(response){\n        console.log(\"Error syncing:\", response);\n      })\n    }\n\n    $scope.destroySelected = function() {\n      let selected = $scope.subItems.filter(function(item){return item.checked});\n      if(!confirm(`Are you sure you want to delete and destroy ${selected.length} items?`)) {\n        return;\n      }\n\n      $scope.destroyItems(selected)\n    }\n\n    $scope.destroyAll = function() {\n      if(!confirm(`Danger: you are about to permanently delete all your items. Are you sure you want to delete and destroy ${$scope.items.length} items?`)) {\n        return;\n      }\n\n      $scope.destroyItems($scope.items)\n    }\n\n    $scope.destroyItems = function(items) {\n      var url = $rootScope.buildURL(\"items\");\n      var request = Restangular.oneUrl(url, url);\n      request.uuids = items.map(function(item){return item.uuid});\n      request.remove().then(function(response){\n        $scope.deselect(items);\n        console.log(\"destroy response\", response);\n        $scope.items = _.difference($scope.items, items);\n        $scope.subItems = _.difference($scope.subItems, items);\n      })\n      .catch(function(response){\n        console.log(\"destroy error:\", response);\n      })\n    }\n\n  }\n}\n\nangular.module('app').controller('DashboardCtrl', DashboardCtrl);\n;class HomeCtrl {\n  constructor($rootScope, $scope, Restangular, $state, $stateParams) {\n\n    $scope.formData = {};\n\n    if($stateParams.server) {\n      $scope.formData.server = $stateParams.server;\n    } else {\n      $scope.formData.server = \"http://localhost:3000\"\n    }\n\n    $scope.formData.email = $stateParams.id;\n    $scope.formData.password = $stateParams.pw;\n\n    $scope.submitLogin = function() {\n      var url = $scope.formData.server + \"/auth/sign_in\";\n      var request = Restangular.oneUrl(url, url);\n      request.email = $scope.formData.email;\n      request.password = $scope.formData.password;\n      request.post().then(function(response) {\n        console.log(\"Success:\", response);\n        sessionStorage.setItem(\"jwt\", response.token);\n        sessionStorage.setItem(\"server\", $scope.formData.server);\n        sessionStorage.setItem(\"user\", JSON.stringify(response.user));\n        $rootScope.signedIn = true;\n      })\n      .catch(function(response){\n        console.log(\"error:\", response);\n        $scope.formData.error = response.data.error;\n      })\n    }\n\n  }\n}\n\nangular.module('app').controller('HomeCtrl', HomeCtrl);\n;angular.module('app')\n  .config(function ($stateProvider, $urlRouterProvider, $locationProvider) {\n\n    $stateProvider\n      .state('base', {\n        abstract: true,\n      })\n\n      .state('home', {\n        url: '/?server&id&pw',\n        parent: 'base',\n        views: {\n          'content@' : {\n            templateUrl: 'templates/home.html',\n            controller: 'HomeCtrl'\n          }\n        }\n      })\n\n      // 404 Error\n      .state('404', {\n        parent: 'base',\n        views: {\n          'content@' : {\n            templateUrl: 'errors/404.html'\n          }\n        }\n      });\n\n      // Default fall back route\n      $urlRouterProvider.otherwise(function($injector, $location){\n         var state = $injector.get('$state');\n         state.go('404');\n         return $location.path();\n      });\n\n      // enable HTML5 Mode for SEO\n      $locationProvider.html5Mode(true);\n\n  });\n"]}